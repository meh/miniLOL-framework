/* miniLOL is released under AGPLv3. Copyleft meh. [http://meh.doesntexist.org | meh@paranoici.org] */
(function(){if(Prototype.Browser.IE)Prototype.Browser.InternetExplorer=true;if(Prototype.Browser.Gecko)Prototype.Browser.Mozilla=true;if(navigator.userAgent.match(/Chrome/))Prototype.Browser.Chrome=true;if(navigator.userAgent.match(/Safari/)&&!Prototype.Browser.Chrome)Prototype.Browser.Safari=true;if(Prototype.Browser.Mozilla||Prototype.Browser.Opera)Prototype.Browser.Good=true;else Prototype.Browser.Bad=true;Prototype.Browser.Name=window.navigator.appName;var b=window.navigator.appVersion;try{if(Prototype.Browser.IE)Prototype.Browser.Version=
parseFloat(b.match(/MSIE ([^;]*)/)[1]);else if(Prototype.Browser.Mozilla||Prototype.Browser.Opera)Prototype.Browser.Version=parseFloat(b);else throw null;}catch(a){Prototype.Browser.Version=0}if(Prototype.Browser.IE)Error.prototype.toString=function(){return"#{name}: #{description}<br/><br/>#{stack}".interpolate({name:this.name,description:this.description,stack:(this.stack||"").replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Opera)Error.prototype.toString=function(){return"#{name}: #{message}".interpolate(this)};
else if(Prototype.Browser.Gecko)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Chrome||Prototype.Browser.Safari)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};if(Prototype.Browser.IE){if(!window.DOMParser)window.DOMParser=
Class.create({parseFromString:function(c){var f=new AciveXObject("Microsoft.XMLDOM");f.async="false";f.loadXML(c);return f}});if(!window.XMLSerializer)window.XMLSerializer=Class.create({serializeToString:function(c){return c.xml}})}})();Function.empty=function(){};Object.extend(Function,function(){return{parse:function(b){matches=b.match(/^function\s*\((.*?)\)[\s\n]*\{([\s\S]*)\}[\s\n]*/m);if(!matches)return null;b=matches[1].split(/\s*,\s*/);return new Function(b,matches[2])}}}());
Object.extend(Function.prototype,function(){return{clone:function(){return Function.parse(this.toString())}}}());
Object.extend(Object,function(){var b,a;if(function(){for(var d in{toString:1})if(d==="toString")return false;return true}()){var c=Object.keys,f=Object.values,g=["toString","valueOf"];b=function(d){var i=c(d);g.each(function(k){d[k]!=Object.prototype[k]&&i.push(k)});return i};a=function(d){var i=f(d);g.each(function(k){d[k]!=Object.prototype[k]&&i.push(d[k])});return i}}else{b=Object.keys;a=Object.values}var e=Object.isFunction(Object.defineProperty)?Object.defineProperty:function(d,i,k){Object.isFunction(k.get)&&
Object.isFunction(d.__defineGetter__)&&d.__defineGetter__(i,k.get);Object.isFunction(k.set)&&Object.isFunction(d.__defineSetter__)&&d.__defineSetter__(i,k.set)};if(Object.isFunction(Object.defineProperties))var h=Object.defineProperties;else Object.defineProperties=function(d,i){for(var k in i)Object.defineProperty(d,k,i[k])};if(Object.isFunction(Object.create))var j=Object.create;else Object.create=function(d,i){var k=Object(d);Object.defineProperties(k,i);return k};return{isObject:function(d){return typeof d==
"object"},isBoolean:function(d){return typeof d=="boolean"||d.constructor===Boolean},isRegExp:function(d){return!Object.isUndefined(d)&&d.constructor==window.RegExp},isClass:function(d){return Boolean(d["__miniLOL.Class__"])},isDocument:function(d){return d.toString().include("Document")},isXML:function(d){if(typeof d!=="object")return false;d=d.ownerDocument||d;if(!d.documentElement)return false;return d.documentElement.nodeName!="HTML"},fromAttributes:function(d){for(var i={},k=0;k<d.length;k++)i[d.item(k).nodeName]=
d.item(k).nodeName;return i},toQueryString:function(d){var i="";for(var k in d)i+="#{name}=#{value}&".interpolate({name:k,value:d[k]});return i.substr(0,i.length-1)},keys:b,values:a,extend:function(d,i,k){k=Object.isUndefined(k)?true:Boolean(k);for(var l=Object.keys(i),m=0,n=l.length;m<n;m++){var o=l[m];if(k||Object.isUndefined(destionation[o]))d[o]=i[o]}return d},extendAttributes:function(d,i,k){k=Object.isUndefined(k)?true:Boolean(k);for(var l in i)if(k||Object.isUndefined(destionation[l]))(function(){var m;
d[l]=function(n,o){return Object.isUndefined(n)&&!o?Object.isFunction(i[l].get)?i[l].get(m):m:Object.isFunction(i[l].set)?m=i[l].set(m,n):m=n}})();return d},without:function(d,i){var k=Object.extend({},d);if(Object.isArray(i))i.each(function(l){delete k[l]});else delete k[i];return k},defineProperty:e,defineProperties:h,create:j}}());
Object.extend(String,function(){return{fromAttributes:function(b){for(var a="",c=0;c<b.length;c++)a+='#{name}="#{value}" '.interpolate({name:b.item(c).nodeName,value:b.item(c).nodeValue});return a},fromXML:function(b){if(!Object.isXML(b))return false;return(new XMLSerializer).serializeToString(b)}}}());
Object.extend(String.prototype,function(){function b(e){Object.isRegExp(e)||(e=/&/);var h={},j=this.match(/[?#](.*?)([#?]|$)/);if(!j)return h;e=j[1].split(e);for(j=0;j<e.length;j++){var d=e[j].split(/=/),i=d[0].decodeURIComponent();if(d=d[1])if(Object.isUndefined(h[i]))h[i]=d.decodeURIComponent();else if(Object.isArray(h[i]))h[i].push(d);else h[i]=[h[i],d];else h[i]=true}return h}var a=window.encodeURI,c=window.decodeURI,f=window.encodeURIComponent,g=window.decodeURIComponent;return{toQueryParams:b,
parseQuery:b,toXML:function(){return(new DOMParser).parseFromString(this,"text/xml")},isURL:function(){return/^(\w+):(\/\/.+?(:\d)?)(\/)?/.test(this)||/^mailto:([\w.%+-]+@[\w.]+\.[A-Za-z]{2,4})$/.test(this)},parseURL:function(){var e;if(e=this.match(/^mailto:(([\w.%+-]+)@([\w.]+\.[A-Za-z]{2,4}))$/))return{protocol:"mailto",uri:e[1],user:e[2],host:e[3]};if(e=this.match(/^((\w+):\/\/(((.+?)(:(\d+))?)(\/.*)?))$/))return{full:e[1],protocol:e[2],uri:e[3],host:e[4],hostname:e[5],port:e[7],path:e[8]};return false},
blank:function(){return this==0},getHashFragment:function(){var e=this.match(/(#.*)$/);return e?e[1]:""},splitEvery:function(e){for(var h=[],j=0;j<this.length;j+=e)h.push(this.substr(j,e));return h},test:function(e){return e.test(this)},commonChars:function(e){return this.toArray().intersect(e.toArray())},format:function(e){var h=this;for(var j in e)h=h.replace(RegExp("\\{"+j+"\\}","g"),e[j].toString());return h},reverse:function(){return this.toArray().reverse().join("")},translate:function(e,h){var j=
this;h?Object.keys(e).each(function(d){if(!h[d])throw Error("The second table value is missing.");j=e[d].is(RegExp)?j.replace(eval(e[d].global?e[d].toString():e[d].toString()+"g")):j.replace(RegExp(e[d],"g"),h[d])}):Object.values(e).each(function(d){if(d.length!=2)throw Error("The array has to be [regex, translation].");j=d[0].is(RegExp)?j.replace(eval(d[0].global?d[0].toString():d[0].toString()+"g"),d[1]):j.replace(RegExp(d[0],"g"),d[1])});return j},toNumber:function(e){return e?parseInt(this):parseFloat(this)},
toBase:function(e){return this.toNumber().toBase(e)},fromBase:function(e){return parseInt(this,e)},toCode:function(){return this.charCodeAt(0)},encodeURI:function(){return a(this)},decodeURI:function(){return c(this)},encodeURIComponent:function(){return f(this)},decodeURIComponent:function(){return g(this)}}}());
Object.extend(Number.prototype,function(){function b(){return this*1E3}function a(){return this}function c(){return this*60}function f(){return this*60*60}function g(){return this*60*60*24}function e(){return this*60*60*24*7}function h(){return this*60*60*24*375}return{milliseconds:b,ms:b,seconds:a,second:a,minutes:c,minute:c,hours:f,hour:f,days:g,day:g,weeks:e,week:e,years:h,year:h,upTo:function(j,d,i){$R(this,j+1,true).each(d,i);return this},isEven:function(){return this%2==0},isOdd:function(){return this%
2!=0},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)},log:function(){return Math.log(this)},pow:function(j){return Math.pow(this,j)},sqrt:function(){return Math.sqrt(this)},sin:function(){return Math.sin(this)},cos:function(){return Math.cos(this)},tan:function(){return Math.tan(this)},asin:function(){return Math.asin(this)},acos:function(){return Math.acos(this)},atan:function(){return Math.atan(this)},
toPaddedString:function(j,d,i){i=Object.isUndefined(i)?"0":i.toString();d=this.toString(d||10);return i.times(j-d.length)+d},toBase:function(j){return this.toString(j).toUpperCase()},toChar:function(){return String.fromCharCode(this)},digits:function(){var j=this.toString().match(/e(.*)$/);return j?j[1].toNumber()>0?1+j[1].toNumber():0:this.toString().length},ordinalized:function(){switch(parseInt(this)){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}}}());
Hash.addMethods(function(){var b=Hash.prototype.toJSON;return{remove:Hash.prototype.unset,clear:function(){var a=this._object;this._object={};return a},replace:function(a){var c=this._object;this._object=Object.isString(a)?miniLOL.JSON.unserialize(a):Object.extend({},a);return c},toJSON:function(a){return a?miniLOL.JSON.serialize(this._object)||"{}":b.call(this)}}}());
(function(){Date.weekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.months=["January","February","March","April","May","June","July","August","September","October","November","December"];var b={"%":function(){return"%"},a:function(a){return Date.weekDays[a.getDay()].substr(0,3)},A:function(a){return Date.weekDays[a.getDay()]},b:function(a){return Date.months[a.getMonth()].substr(0,3)},B:function(a){return Date.months[a.getMonth()]},c:function(a){return a.format("%a %b %_d %X %Y")},
C:function(a){return a.getFullYear().substr(0,2)},d:function(a){return a.getDate().toPaddedString(2)},D:function(a){return a.format("%m/%d/%y")},d:function(a){return(a.getMonth()+1).toPaddedString(2)},j:function(a){return a.getDate()},N:function(a){return a.getDay()==0?7:a.getDay()},S:function(a){return a.getDate().ordinalized()},w:function(a){return a.getDay()},z:function(a){var c=new Date;c.setFullYear(a.getFullYear());c.setDate(1);c.setMonth(0);return((a.getTime()-c.getTime())/1E3/60/60/24).ceil()},
W:function(a){var c=new Date;c.setFullYear(a.getFullYear());c.setDate(1);c.setMonth(0);return((a.getTime()-c.getTime())/1E3/60/60/24/7).ceil()},n:function(a){return a.getMonth()+1},t:function(a){if(a.getMonth()%2==0)return 31;if(a.getMonth()==1)return a.getFullYear()%4==0?29:28;return 30},L:function(a){return a.getFullYear()%4?0:1},o:function(a){return a.getFullYear()},Y:function(a){return a.getFullYear()},y:function(a){return a.getFullYear().toString().substr(2,2)},a:function(a){return a.getHours()>
12?"pm":"am"},A:function(a){return a.getHours()>12?"PM":"AM"},B:function(a){var c=new Date(a);c.setHours(0);c.setSeconds(0);c.setMinutes(0);return((a.getTime()-c.getTime())/1E3/86.4).toFixed(2)},g:function(a){return a.getHours()+1>12?(a.getHours()+1)/2:a.getHours()+1},g:function(a){return a.getHours()},h:function(a){return(a.getHours()+1>12?(a.getHours()+1)/2:a.getHours()+1).toPaddedString(2)},H:function(a){return a.getHours().toPaddedString(2)},i:function(a){return a.getMinutes().toPaddedString(2)},
s:function(a){return a.getSeconds().toPaddedString(2)},u:function(a){return a.getMilliseconds()*1E3},r:function(a){return a.toUTCString()},U:function(a){return a.getTime()}};Object.extend(Date,function(){var a=Date.parse;return{parse:function(c){if(!c.include("%"))return a(c)}}}());Object.extend(Date.prototype,function(){return{format:function(a){var c=this;return a.gsub(/%([\-_0^#])?(.)/,function(f){return b[f[1]]?b[f[1]](c):f[1]})}}}())})();
window.Element.addMethods(function(){return{load:function(b,a){if(a&&!Object.isUndefined(a.frequency))new Ajax.PeriodicalUpdater(this,b,a);else new Ajax.Updater(this,b,a)},xpath:Prototype.Browser.IE?function(b,a){if(Object.isUndefined(a)){a=b;b=this}for(var c=[],f=b.selectNodes(a),g=0;g<f.length;g++)c.push(f.item(g));return c}:function(b,a){if(Object.isUndefined(a)){a=b;b=this}for(var c=[],f=(b.ownerDocument||b).evaluate(a,b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),g=0;g<f.snapshotLength;g++)c.push(f.snapshotItem(g));
return c},select:function(b,a){if(Object.isUndefined(a)){a=b;b=this}return Prototype.Selector.select(a,b)},getTextDescendants:function(b){function a(f){for(f=f.firstChild;f;){Node.TEXT_NODE==f.nodeType&&c.push(f);Object.isElement(f)&&a(f);f=f.nextSibling}}b=b||this;var c=[];a(b);return c},getFirstText:function(b){b=b||this;var a="";if(Object.isElement(b))b=$A(b.childNodes);else Object.isArray(b)||(b=$A(b));b.each(function(c){switch(c.nodeType){case Node.ELEMENT_NODE:throw $break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:if(!c.nodeValue.blank()){a=
c.nodeValue.strip();throw $break;}break}});return a},toObject:function(b){b=b||this;var a={};if(!Object.isElement(b)&&!Object.isDocument(b))return a;$A(b.childNodes).each(function(c){if(c.nodeType==Node.ELEMENT_NODE)if(c.getElementsByTagName("*").length==0){var f="";$A(c.childNodes).each(function(g){g.nodeType!=Node.CDATA_SECTION_NODE&&g.nodeType!=Node.TEXT_NODE||g.nodeValue.blank()||(f+=g.nodeValue)});a[c.nodeName]=f}else a[c.nodeName]=Element.toObject(c)});return a}}}());
if(!Object.isObject(window.miniLOL))window.miniLOL={error:Function.empty,Framework:{Version:"0.1"}};
Class=function(){var b={Normal:1,Abstract:2},a=function(){return{addMethods:function(c){for(var f=this.superclass&&this.superclass.prototype,g=Object.keys(c),e=0,h=g.length;e<h;e++){var j=g[e],d=c[j];if(f&&Object.isFunction(d)&&d.argumentNames().first()=="$super"){var i=d;d=function(k){return function(){return f[k].apply(this,arguments)}}(j).wrap(i);d.valueOf=i.valueOf.bind(i);d.toString=i.toString.bind(i)}this.prototype[j]=d;if(this.__type__==Class.Abstract)this[j]=d}},addStatic:function(c){for(var f=
Object.keys(c),g=0,e=f.length;g<e;g++){var h=f[g];this[h]=c[h]}},addAttributes:function(c){Object.extendAttributes(this.prototype,c);this.__type__==Class.Abstract&&Object.extendAttributes(this,c)}}}();return{create:function(){var c=$A(arguments),f=Object.isFunction(c.first())?c.shift():null,g=function(){switch(this.__type__){case b.Abstract:throw Error("You cannot instantiate an abstract class.");default:if(Object.isFunction(this.initialize))return this.initialize.apply(this,arguments);break}return null};
g["__miniLOL.Class__"]=true;Object.extend(g,Class.Methods);g.superclass=f;g.subclasses=[];if(f){if(!f.__type__)f.__type__=b.Normal;if(!f.subclasses)f.subclasses=[];var e=Function.empty.clone();e.prototype=f.prototype;g.prototype=new e;f.subclasses.push(g)}g.__type__=g.prototype.__type__=c.first().type||Class.Normal;c.each(function(h){g.addMethods({initialize:h.initialize||h.constructor||Function.empty.clone()});g.addMethods(Object.without(h,["constructor","initialize","Methods","Static","Attributes"]));
g.addMethods(h.Methods||{});g.addStatic(h.Static||{});g.addAttributes(h.Attributes||{})});return g.prototype.constructor=g},Type:b,Methods:a}}();
miniLOL.utils=function(){return{exists:function(b){var a=false;new Ajax.Request(b,{method:"head",asynchronous:false,onSuccess:function(){a=true}});return a},get:function(b,a){var c;new Ajax.Request(b,{method:"get",minified:a,asynchronous:false,onSuccess:function(f){c=f.responseText}});return c},execute:function(b){var a,c;new Ajax.Request(b,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(f){try{a=window.eval(f.responseText)}catch(g){c=g;c.fileName=b;c.lineNumber-=5}},onFailure:function(f){c=
Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:b,status:f.status,statusText:f.statusText}));c.fileName=b;c.lineNumber=0}});if(c)throw c;return a},include:function(b){var a=false;new Ajax.Request(b,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(c){try{window.eval(c.responseText);a=true}catch(f){a=false}}});return a},require:function(b){var a=false;new Ajax.Request(b,{method:"get",asynchronous:false,evalJS:false,onSuccess:function(c){try{window.eval(c.responseText)}catch(f){a=
f;a.fileName=b;a.lineNumber-=5}},onFailure:function(c){a=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:b,status:c.status,statusText:c.statusText}));a.fileName=b;a.lineNumber=0;a.http={status:c.status,text:c.statusText}}});if(a)throw a;return true}}}();
miniLOL.History={interval:0.15,initialize:function(){miniLOL.History.current=window.location.hash||"#";if(Prototype.Browser.Opera&&history.navigationMode)history.navigationMode="compatible";Event.observe(document,":url.change",function(b){miniLOL.History.current=b.memo.toString()||"#"});miniLOL.History.Initializers.get().call()},reset:function(b,a){if(Object.isNumber(b))miniLOL.History.interval=b;Object.isUndefined(miniLOL.History.timer)||clearInterval(miniLOL.History.timer);miniLOL.History.timer=
setInterval(a,miniLOL.History.interval*1E3)},Initializers:{get:function(){return"onhashchange"in window&&!(Prototype.Browser.InternetExplorer&&Prototype.Browser.Version==7)?miniLOL.History.Initializers.Default:Prototype.Browser.InternetExplorer?miniLOL.History.Initializers.InternetExplorer:miniLOL.History.Initializers.Unsupported},Default:function(){Event.observe(window,"hashchange",function(){Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||
"#"))})},Unsupported:function(){document.observe("dom:loaded",function(){miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.Default)})},InternetExplorer:function(){document.observe("dom:loaded",function(){miniLOL.History.IE={check:function(){if(!miniLOL.History.IE.element.parentNode||miniLOL.History.IE.element.parentNode.nodeName=="#document-fragment")$(document.body).insert({top:miniLOL.History.IE.element})},put:function(b){miniLOL.History.IE.check();var a=miniLOL.History.IE.element.contentWindow.document;
a.open();a.close();a.location.hash=encodeURIComponent(b.substring(1))},get:function(){miniLOL.History.IE.check();return miniLOL.History.IE.element.contentWindow.document.location.hash},element:new Element("iframe",{id:"__miniLOL.History",style:"display: none !important; z-index: -9001 !important;",src:"javascript:false;"})};$(document.body).insert({top:miniLOL.History.IE.element});miniLOL.History.IE.put(miniLOL.History.current);miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.InternetExplorer)})}},
Checkers:{Default:function(){if(miniLOL.History.current!=window.location.hash)Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||"#"))},InternetExplorer:function(){var b={iframe:miniLOL.History.IE.get(),actual:window.location.hash||"#",current:miniLOL.History.current};if(b.actual!=b.iframe){if(b.actual&&b.actual==b.current)window.location.hash=(miniLOL.History.current=b.iframe).substring(1);else miniLOL.History.IE.put(miniLOL.History.current=
b.actual);Event.fire(document,":url.change",miniLOL.History.current)}}}};miniLOL.History.initialize();
miniLOL.Resource=Class.create({initialize:function(b,a){if(!a)throw Error("No wrapper has been passed.");this.name=b;this.wrapper=a;if(!this.wrapper.clear)this.wrapper.clear=function(){this.data={}};for(var c in this.wrapper){if(Object.isFunction(this.wrapper[c])){if(this.wrapper[c].parent==this.wrapper)break;this.wrapper[c]=this.wrapper[c].bind(this.wrapper);this.wrapper[c].parent=this.wrapper}if(Object.isUndefined(this[c]))this[c]=this.wrapper[c]}this.clear();this.flush();this.wrapper.initialize&&
this.wrapper.initialize()},load:function(){var b,a=$A(arguments);Event.fire(document,":resource.load",{resource:this,arguments:a});this.calls.push(a);try{b=this.wrapper.load.apply(this.wrapper,a)}catch(c){miniLOL.error("Error while loading `#{name}` resource.\n#{error}".interpolate({name:this.name,error:c.toString()}));return false}Event.fire(document,":resource.loaded",{resource:this,arguments:a});return b},reload:function(){Event.fire(document,":resource.reload",{resource:this});this.wrapper.clear();
this.flush().each(function(b){this.load.apply(this,b)},this);Event.fire(document,":resource.reloaded",{resource:this})},clear:function(){Event.fire(document,":resource.clear",{resource:this});this.wrapper.clear()},flush:function(b){Event.fire(document,":resource.flush",{resource:this,call:b});var a;if(Object.isArray(b)){if(a=this.calls.find(function(c){if(c.length!=b.length)return false;for(var f=false,g=0;g<c.length;g++){if(b[g]==c[g])f=true;if(!f)break}return f}))this.calls=this.calls.filter(function(c){return c!=
a})}else{a=this.calls;this.calls=[]}return a},data:function(){return this.wrapper.data}});
miniLOL.JSON=function(){return{parse:function(b){return new miniLOL.JSON(b)},serializeSpecial:function(b){if(typeof b!=="object")return b;b=Object.clone(b);for(var a in b)b[a]=Object.isXML(b[a])?{__miniLOL_is_xml:true,value:String.fromXML(b[a])}:Object.isFunction(b[a])?{__miniLOL_is_function:true,value:b[a].toString()}:miniLOL.JSON.serializeSpecial(b[a]);return b},unserializeSpecial:function(b){if(typeof b!=="object")return b;b=Object.clone(b);for(var a in b)b[a]=b[a].__miniLOL_is_xml?b[a].value.toXML():
b[a].__miniLOL_is_function?Function.parse(b[a].value):miniLOL.JSON.unserializeSpecial(b[a]);return b},serialize:function(b){try{return Object.toJSON(miniLOL.JSON.serializeSpecial(b))}catch(a){return false}},unserialize:function(b){if(!Object.isString(b))return null;try{return miniLOL.JSON.unserializeSpecial(b.evalJSON())}catch(a){return null}}}}();
miniLOL.Cookie=function(){function b(g){return Object.extend({expires:new Date(Date.now()+(1).day().ms()),path:"",domain:"",secure:"",raw:false},g||{})}function a(g,e,h){if(Object.isUndefined(h))h={};return"#{key}=#{value}; #{maxAge}#{expires}#{path}#{domain}#{secure}".interpolate({key:g.encodeURIComponent(),value:e.encodeURIComponent(),maxAge:!Object.isUndefined(h.maxAge)?"max-age=#{0}; ".interpolate([h.maxAge]):"",expires:!Object.isUndefined(h.expires)?"expires=#{0}; ".interpolate([h.expires.toUTCString()]):
"",path:!Object.isUndefined(h.path)?"path=#{0}; ".interpolate([h.path]):"",domain:!Object.isUndefined(h.domain)?"domain=#{0}; ".interpolate([h.domain]):"",secure:h.secure?"secure":""})}function c(){var g=[];window.document.cookie.split(/; /).each(function(e){e=e.split(/=/);g.push(e[0])});return g.uniq()}function f(g,e){window.document.cookie=a(g,"",Object.extend(b(e),{expires:new Date(0)}))}return{encode:a,keys:c,get:function(g,e){e=b(e);var h=window.document.cookie.match(RegExp.escape(g.encodeURIComponent())+
"=([^;]*)","g");if(h){var j=[];$A(h).each(function(d){d=d.match(/^.*?=(.*)$/)[1].decodeURIComponent();j.push(e.raw?d:miniLOL.JSON.unserialize(d)||d)});if(j.length==1)j=j[0];return j}},set:function(g,e,h){h=b(h);h.raw||(e=miniLOL.JSON.serialize(e)||e);window.document.cookie=a(g,e,h)},remove:f,clear:function(){c().each(function(g){f(g)})}}}();
miniLOL.Storage=Class.create({initialize:function(b,a){this.name=b;this.backend=miniLOL.Storage.Instances[b]?miniLOL.Storage.Instances[b]:miniLOL.Storage.Instances[b]=new (a||miniLOL.Storage.Backends.available())(b)},get:function(b){return this.backend.get(b.toString())},set:function(b,a,c){return this.backend.set(b.toString(),a,c)},remove:function(b,a){return this.backend.remove(b.toString(),a)},clear:function(b){return this.backend.clear(b)},size:function(){return this.backend.size},save:function(){this.backend.save()}});
miniLOL.Storage.Instances={};
miniLOL.Storage.Backend=Class.create(Hash,{initialize:function($super,a,c){$super((Object.isString(c)?miniLOL.JSON.unserialize(c):c)||{});this.name=miniLOL.Storage.Backend.filter(a);if(Object.isString(c))this.size=c.size},get:function($super,a){return $super(a)},set:function($super,a,c,f){a=$super(a,c);f||this.save();return a},remove:function($super,a,c){a=$super(a);c||this.save();return a},clear:function($super,a){var c=$super();a||this.save();return c},replace:function($super,a){this.size=Object.isString(a)?
a.length:0;return $super(a)},Static:{filter:function(b){return b.replace(/\s/g,"")}}});
miniLOL.Storage.Backends={available:function(){try{return window.localStorage?miniLOL.Storage.Backends.LocalStorage:window.globalStorage?miniLOL.Storage.Backends.GlobalStorage:document.body.addBehavior?miniLOL.Storage.Backends.UserDataBehavior:miniLOL.Storage.Backends.Cookie}catch(b){return miniLOL.Storage.Backends.Null}},LocalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,a){$super(a);this.replace(window.localStorage["__miniLOL.storage."+this.name]||"{}")},save:function(){var b=
this.toJSON(true);this.size=b.length;window.localStorage["__miniLOL.storage."+this.name]=b}}),GlobalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,a){$super(a);this.replace(window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]||"{}")},save:function(){var b=this.toJSON(true);this.size=b.length;window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]=b}}),UserDataBehavior:Class.create(miniLOL.Storage.Backend,{initialize:function($super,
a){$super(a);this.element=document.createElement("link");this.element.addBehavior("#default#userData");$$("head")[0].appendChild(this.element);this.element.load("__miniLOL.storage."+a);var c=this.element.getAttribute("__miniLOL.storage."+this.name)||"{}";this.size=c.length;this.replace(c)},save:function(){var b=this.toJSON(true);this.size=b.length;this.element.setAttribute("__miniLOL.storage."+this.name,b);this.element.save("__miniLOL.storage."+this.name)}}),Cookie:Class.create(miniLOL.Storage.Backend,
{initialize:function($super,a){$super(a);this.replace(miniLOL.Cookie.get("__miniLOL.storage."+this.name,{raw:true})||"{}")},save:function(){var b=this.toJSON(true);this.size=b.length;miniLOL.Cookie.set("__miniLOL.storage."+this.name,b,{expires:31536E3,raw:true})}}),Null:Class.create(miniLOL.Storage.Backend,{save:Function.empty})};
miniLOL.Document=function(){return{fix:Prototype.Browser.IE?function(b){if(b){b={real:b};b.documentElement=b.real.documentElement;b.getElementsByTagName=function(a){return this.real.getElementsByTagName(a)};b.getElementById=function(a){return Element.xpath(this,"//*[@id='#{0}']".interpolate([a])).first()}.bind(b.real);b.real.setProperty("SelectionLanguage","XPath");b.xpath=Element.xpath.bind(b.real);b.select=Element.select.bind(b.real);return b}}:Prototype.Browser.Good?function(b){if(b){b.xpath=Element.xpath;
b.select=Element.select;return b}}:function(b){if(b){b.getElementById=function(a){return this.xpath("//*[@id='#{0}']".interpolate([a])).first()};b.xpath=Element.xpath;b.select=Element.select;return b}},check:function(b,a){var c=false;b||(c="There is a syntax error.");if(b.documentElement.nodeName=="parsererror")c=b.documentElement.textContent;if(a&&c){miniLOL.error("Error while parsing #{path}\n\n#{error}".interpolate({path:a,error:c}),true);return c}return c}}}();
miniLOL.CSS=function(){return{include:function(b,a){if(a)a=b.replace(/\.css$/,".min.css");var c=$$("link").find(function(f){return f.getAttribute("href")==b||f.getAttribute("href")===a});if(!c){if(a&&miniLOL.utils.exists(a))b=a;else if(!miniLOL.utils.exists(b))return false;c=new Element("link",{rel:"stylesheet",href:b,type:"text/css"});$$("head")[0].insert(c);Event.fire(document,":css.included",c)}return c},create:function(b,a){var c=new Element("style",{type:"text/css"});if(Prototype.Browser.IE)c.styleSheet.cssText=
b;else c.update(b);a&&c.setAttribute("id",a);$$("head").first().appendChild(c);Event.fire(document,":css.created",c);return c}}}();
