/* miniLOL is released under AGPLv3. Copyleft meh. [http://meh.paranoid.pk | meh@paranoici.org] */
(function(){if(Prototype.Browser.IE)Prototype.Browser.InternetExplorer=!0;if(Prototype.Browser.Gecko)Prototype.Browser.Mozilla=!0;if(navigator.userAgent.match(/Chrome/))Prototype.Browser.Chrome=!0;if(navigator.userAgent.match(/Safari/)&&!Prototype.Browser.Chrome)Prototype.Browser.Safari=!0;Prototype.Browser.Mozilla||Prototype.Browser.Opera?Prototype.Browser.Good=!0:Prototype.Browser.Bad=!0;Prototype.Browser.Name=window.navigator.appName;var b=window.navigator.appVersion;try{if(Prototype.Browser.IE)Prototype.Browser.Version=
parseFloat(b.match(/MSIE ([^;]*)/)[1]);else if(Prototype.Browser.Mozilla||Prototype.Browser.Opera)Prototype.Browser.Version=parseFloat(b);else throw null;}catch(c){Prototype.Browser.Version=0}if(Prototype.Browser.IE)Error.prototype.toString=function(){return"#{name}: #{description}<br/><br/>#{stack}".interpolate({name:this.name,description:this.description,stack:(this.stack||"").replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Opera)Error.prototype.toString=function(){return"#{name}: #{message}".interpolate(this)};
else if(Prototype.Browser.Gecko)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};else if(Prototype.Browser.Chrome||Prototype.Browser.Safari)Error.prototype.toString=function(){return"#{name}: #{message}<br/><br/>#{stack}".interpolate({name:this.name,message:this.message,stack:this.stack.replace(/\n/g,"<br/>")})};if(Prototype.Browser.IE){if(!window.DOMParser)window.DOMParser=
Class.create({parseFromString:function(a){var b=new AciveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b}});if(!window.XMLSerializer)window.XMLSerializer=Class.create({serializeToString:function(a){return a.xml}})}})();Function.empty=function(){};Object.extend(Function,function(){return{parse:function(b){matches=b.match(/^function\s*\((.*?)\)[\s\n]*\{([\s\S]*)\}[\s\n]*/m);if(!matches)return null;b=matches[1].split(/\s*,\s*/);return new Function(b,matches[2])}}}());
Object.extend(Function.prototype,function(){return{clone:function(){return Function.parse(this.toString())}}}());
Object.extend(Object,function(){var b,c;if(function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}()){var a=Object.keys,e=Object.values,d=["toString","valueOf"];b=function(b){var c=a(b);d.each(function(a){b[a]!=Object.prototype[a]&&c.push(a)});return c};c=function(a){var b=e(a);d.each(function(c){a[c]!=Object.prototype[c]&&b.push(a[c])});return b}}else b=Object.keys,c=Object.values;var f=Object.isFunction(Object.defineProperty)?Object.defineProperty:function(a,b,c){Object.isFunction(c.get)&&
Object.isFunction(a.__defineGetter__)&&a.__defineGetter__(b,c.get);Object.isFunction(c.set)&&Object.isFunction(a.__defineSetter__)&&a.__defineSetter__(b,c.set)};if(Object.isFunction(Object.defineProperties))var h=Object.defineProperties;else Object.defineProperties=function(a,b){for(var c in b)Object.defineProperty(a,c,b[c])};if(Object.isFunction(Object.create))var g=Object.create;else Object.create=function(a,b){var c=Object(a);Object.defineProperties(c,b);return c};return{is:function(a,b){return!Object.isUndefined(b)&&
(b instanceof a||b==a)},isObject:function(a){return typeof a=="object"&&a.constructor===Object},isBoolean:function(a){return typeof a=="boolean"||a.constructor===Boolean},isRegExp:function(a){return!Object.isUndefined(a)&&a.constructor==window.RegExp},isClass:function(a){return Boolean(a["__miniLOL.Class__"])},isDocument:function(a){return a.nodeType===Node.DOCUMENT_NODE},isXML:function(a){if(typeof a!=="object")return!1;a=a.ownerDocument||a;if(!a.documentElement)return!1;return a.documentElement.nodeName!=
"HTML"},fromAttributes:function(a){for(var b={},c=0;c<a.length;c++)b[a.item(c).nodeName]=a.item(c).nodeName;return b},toQueryString:function(a){var b="",c;for(c in a)b+="#{name}=#{value}&".interpolate({name:c,value:a[c]});return b.substr(0,b.length-1)},keys:b,values:c,extend:function(a,b,c){for(var c=Object.isUndefined(c)?!0:Boolean(c),e=Object.keys(b||{}),f=0,h=e.length;f<h;f++){var g=e[f];if(c||Object.isUndefined(destionation[g]))a[g]=b[g]}return a},extendAttributes:function(a,b,c){var c=Object.isUndefined(c)?
!0:Boolean(c),e;for(e in b)(c||Object.isUndefined(destionation[e]))&&function(){var c;a[e]=function(a,f){return Object.isUndefined(a)&&!f?Object.isFunction(b[e].get)?b[e].get(c):c:Object.isFunction(b[e].set)?c=b[e].set(c,a):c=a}}();return a},without:function(a,b){var c=Object.extend({},a);Object.isArray(b)?b.each(function(a){delete c[a]}):delete c[b];return c},defineProperty:f,defineProperties:h,create:g}}());
Object.extend(String,function(){return{fromAttributes:function(b){for(var c="",a=0;a<b.length;a++)c+='#{name}="#{value}" '.interpolate({name:b.item(a).nodeName,value:b.item(a).nodeValue});return c},fromXML:function(b){if(!Object.isXML(b))return!1;return(new XMLSerializer).serializeToString(b)}}}());
Object.extend(String.prototype,function(){function b(a){Object.isRegExp(a)||(a=/&/);var b={},c=this.match(/[?#](.*?)([#?]|$)/);if(!c)return b;a=c[1].split(a);for(c=0;c<a.length;c++){var e=a[c].split(/=/),d=e[0].decodeURIComponent();(e=e[1])?Object.isUndefined(b[d])?b[d]=e.decodeURIComponent():Object.isArray(b[d])?b[d].push(e):b[d]=[b[d],e]:b[d]=!0}return b}var c=window.encodeURI,a=window.decodeURI,e=window.encodeURIComponent,d=window.decodeURIComponent;return{toQueryParams:b,parseQuery:b,toXML:function(){return(new DOMParser).parseFromString(this,
"text/xml")},isURL:function(){return/^(\w+):(\/\/.+?(:\d)?)(\/)?/.test(this)||/^mailto:([\w.%+-]+@[\w.]+\.[A-Za-z]{2,4})$/.test(this)},parseURL:function(){var a;if(a=this.match(/^mailto:(([\w.%+-]+)@([\w.]+\.[A-Za-z]{2,4}))$/))return{protocol:"mailto",uri:a[1],user:a[2],host:a[3]};if(a=this.match(/^((\w+):\/\/(((.+?)(:(\d+))?)(\/.*)?))$/))return{full:a[1],protocol:a[2],uri:a[3],host:a[4],hostname:a[5],port:a[7],path:a[8]};return!1},blank:function(){return this==0},getHashFragment:function(){var a=
this.match(/(#.*)$/);return a?a[1]:""},splitEvery:function(a){for(var b=[],c=0;c<this.length;c+=a)b.push(this.substr(c,a));return b},test:function(a){return a.test(this)},commonChars:function(a){return this.toArray().intersect(a.toArray())},format:function(a){var b=this,c;for(c in a)b=b.replace(RegExp("\\{"+c+"\\}","g"),a[c].toString());return b},reverse:function(){return this.toArray().reverse().join("")},translate:function(a,b){var c=this;b?Object.keys(a).each(function(e){if(!b[e])throw Error("The second table value is missing.");
c=a[e].is(RegExp)?c.replace(eval(a[e].global?a[e].toString():a[e].toString()+"g")):c.replace(RegExp(a[e],"g"),b[e])}):Object.values(a).each(function(a){if(a.length!=2)throw Error("The array has to be [regex, translation].");c=a[0].is(RegExp)?c.replace(eval(a[0].global?a[0].toString():a[0].toString()+"g"),a[1]):c.replace(RegExp(a[0],"g"),a[1])});return c},interpolate:function(a,b){return Object.isRegExp(b)?(new Template(this,b)).evaluate(a):(new miniLOL.Template(this,b)).evaluate(a)},toNumber:function(a){return a?
parseInt(this):parseFloat(this)},toBase:function(a){return this.toNumber().toBase(a)},fromBase:function(a){return parseInt(this,a)},toCode:function(){return this.charCodeAt(0)},toPaddedString:function(a,b,c){b=Object.isUndefined(c||b)?"0":(c||b).toString();return b.times(a-this.length)+this},toInvertedCase:function(){for(var a="",b=0,c=this.length;b<c;b++){var e=this.charAt(b),d=e.toLowerCase(),k=e.toUpperCase();a+=k==d?d:e==d?k:d}return a},encodeURI:function(){return c(this)},decodeURI:function(){return a(this)},
encodeURIComponent:function(){return e(this)},decodeURIComponent:function(){return d(this)}}}());
Object.extend(Number.prototype,function(){function b(){return this*1E3}function c(){return this}function a(){return this*60}function e(){return this*3600}function d(){return this*86400}function f(){return this*604800}function h(){return this*324E5}return{milliseconds:b,ms:b,seconds:c,second:c,minutes:a,minute:a,hours:e,hour:e,days:d,day:d,weeks:f,week:f,years:h,year:h,upTo:function(a,b,c){$R(this,a+1,!0).each(b,c);return this},isEven:function(){return this%2==0},isOdd:function(){return this%2!=0},
abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)},log:function(){return Math.log(this)},pow:function(a){return Math.pow(this,a)},sqrt:function(){return Math.sqrt(this)},sin:function(){return Math.sin(this)},cos:function(){return Math.cos(this)},tan:function(){return Math.tan(this)},asin:function(){return Math.asin(this)},acos:function(){return Math.acos(this)},atan:function(){return Math.atan(this)},
toPaddedString:function(a,b,c){c=Object.isUndefined(c)?"0":c.toString();b=this.toString(b||10);return c.times(a-b.length)+b},toBase:function(a){return this.toString(a).toUpperCase()},toChar:function(){return String.fromCharCode(this)},digits:function(){var a=this.toString().match(/e(.*)$/);return a?a[1].toNumber()>0?1+a[1].toNumber():0:this.toString().length},ordinalized:function(){switch(parseInt(this)){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}}}());
Object.extend(Enumerable,function(){return{empty:function(){return this.length==0}}}());Object.extend(Array.prototype,Enumerable);Hash.addMethods(function(){var b=Hash.prototype.toJSON;return{remove:Hash.prototype.unset,clear:function(){var b=this._object;this._object={};return b},replace:function(b){var a=this._object;this._object=Object.isString(b)?miniLOL.JSON.unserialize(b):Object.extend({},b);return a},toJSON:function(c){return c?miniLOL.JSON.serialize(this._object)||"{}":b.call(this)}}}());
(function(){Date.weekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.months=["January","February","March","April","May","June","July","August","September","October","November","December"];var b={d:2,H:2,I:2,j:3,k:2,l:2,m:2,M:2,N:9,S:2,U:2,V:2,W:2,y:2,i:3};Object.extend(Date,function(){var a=Date.parse;return{parse:function(b){if(!b.include("%"))return a(b)}}}());var c={flag:{"-":function(a){return a},_:function(a,b){return a.toPaddedString(b,10," ")},0:function(a,
b){return a.toPaddedString(b,10,"0")},"^":function(a,b){return a.toString().toUpperCase().toPaddedString(b," ")},"#":function(a,b){return a.toString().toInvertedCase().toPaddedString(b," ")}},"%":function(){return"%"},a:function(a){return Date.weekDays[a.getDay()].substr(0,3)},A:function(a){return Date.weekDays[a.getDay()]},b:function(a){return Date.months[a.getMonth()].substr(0,3)},B:function(a){return Date.months[a.getMonth()]},c:function(a){return a.format("%a %b %_d %X %Y")},C:function(a){return a.getFullYear().toString().substr(0,
2)},d:function(a){return a.getDate()},D:function(a){return a.format("%m/%d/%y")},e:function(a){return a.format("%_d")},F:function(a){return a.format("%Y-%m-%d")},g:function(a){return a.format("%y")},G:function(a){return a.format("%Y")},h:function(a){return a.format("%b")},H:function(a){return a.getHours()},I:function(a){a=a.getHours();return a+1>12?(a+1)/2:a+1},j:function(a){var b=new Date;b.setFullYear(a.getFullYear());b.setDate(1);b.setMonth(0);return((a.getTime()-b.getTime())/1E3/60/60/24).ceil()},
k:function(a){return a.format("%_H")},l:function(a){return a.format("%_l")},m:function(a){return a.getMonth()+1},M:function(a){return a.getMinutes()},n:function(){return"\n"},N:function(a){return a.getMilliseconds()*1E6},p:function(a){return a.getHours()>12?"PM":"AM"},P:function(a){return a.format("%#p")},r:function(a){return a.format("%I:%M:%S %p")},R:function(a){return a.format("%H:%M")},s:function(a){return a.getDate()},S:function(a){return a.getSeconds()},t:function(){return"\t"},T:function(a){return a.format("%H:%M:%S")},
u:function(a){return a.getDay()==0?7:a.getDay()},U:function(a){var b=new Date;b.setFullYear(a.getFullYear());b.setDate(1);b.setMonth(0);return((a.getTime()-b.getTime())/1E3/60/60/24/7).ceil()},V:function(a){return a.format("%U")},w:function(a){return a.getDay()},W:function(a){return a.format("%U")},x:function(a){return a.format("%m/%d/%y")},X:function(a){return a.format("%T")},y:function(a){return a.getFullYear().toString().substr(2,2)},Y:function(a){return a.getFullYear()},E:function(a){if(a.getMonth()%
2==0)return 31;if(a.getMonth()==1)return a.getFullYear()%4==0?29:28;return 30},o:function(a){return a.getDate().ordinalized()},O:function(a){return a.getFullYear()%4?0:1},i:function(a){var b=new Date(a);b.setHours(0);b.setSeconds(0);b.setMinutes(0);return((a.getTime()-b.getTime())/1E3/86.4).toFixed(2)}};Object.extend(Date.prototype,function(){return{format:function(a){var e=this;return a.gsub(/%([\-_0^#])?(\d+)?(.)/,function(a){var f=a[1]||"0",h=parseInt(a[2]||b[g]||"0"),g=a[3];if(!c[g])return a[0];
return c.flag[f](c[g](e),h)})}}}())})();
Element.addMethods(function(){return{load:function(b,c){c&&!Object.isUndefined(c.frequency)?new Ajax.PeriodicalUpdater(this,b,c):new Ajax.Updater(this,b,c)},xpath:Prototype.Browser.IE?function(b,c){Object.isUndefined(c)&&(c=b,b=this);for(var a=[],e=b.selectNodes(c),d=0;d<e.length;d++)a.push(e.item(d));return a}:function(b,c){Object.isUndefined(c)&&(c=b,b=this);for(var a=[],e=(b.ownerDocument||b).evaluate(c,b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),d=0;d<e.snapshotLength;d++)a.push(e.snapshotItem(d));
return a},select:function(b,c){Object.isUndefined(c)&&(c=b,b=this);return Prototype.Selector.select(c,b)},getTextDescendants:function(b){function c(b){for(b=b.firstChild;b;)Node.TEXT_NODE==b.nodeType&&a.push(b),Object.isElement(b)&&c(b),b=b.nextSibling}var a=[];c(b||this);return a},getFirstText:function(b){var b=b||this,c="";Object.isElement(b)?b=$A(b.childNodes):Object.isArray(b)||(b=$A(b));b.each(function(a){switch(a.nodeType){case Node.ELEMENT_NODE:throw $break;case Node.CDATA_SECTION_NODE:case Node.TEXT_NODE:if(!a.nodeValue.blank())throw c=
a.nodeValue.strip(),$break;}});return c},toObject:function(b){var b=b||this,c={};if(!Object.isElement(b)&&!Object.isDocument(b))return c;$A(b.childNodes).each(function(a){if(a.nodeType==Node.ELEMENT_NODE)if(a.getElementsByTagName("*").length==0){var b="";$A(a.childNodes).each(function(a){a.nodeType!=Node.CDATA_SECTION_NODE&&a.nodeType!=Node.TEXT_NODE||a.nodeValue.blank()||(b+=a.nodeValue)});c[a.nodeName]=b}else c[a.nodeName]=Element.toObject(a)});return c}}}());
Ajax.Request.addMethods({request:function(b){this.url=b;this.method=this.options.method;if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();if(this.options.minified&&(b=this.url.replace(/\.([^.]+)$/,".min.$1"),miniLOL.utils.exists(b)))this.url=b;if(this.options.cached===!1)this.url+=(this.url.include("?")?"&":"?")+Math.random(),this.options.requestHeaders=Object.extend(this.options.requestHeaders||{},{"Cache-Control":"must-revalidate",Pragma:"no-cache"});
b=Object.toQueryString(this.options.parameters);if(!["get","post","head"].include(this.method))b+=(b?"&":"")+"_method="+this.method,this.method="post";b&&(this.method=="get"||this.method=="head"?this.url+=(this.url.include("?")?"&":"?")+b:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(b+="&_="));this.parameters=b.toQueryParams();try{var c=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(c);Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),
this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||b:null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)this.onStateChange()}catch(a){this.dispatchException(a)}}});if(!Object.isObject(window.miniLOL))window.miniLOL={error:Function.empty,Framework:{Version:"0.1"}};
Class=function(){var b={Normal:1,Abstract:2},c=function(){return{addMethods:function(a){for(var b=this.superclass&&this.superclass.prototype,c=Object.keys(a),f=0,h=c.length;f<h;f++){var g=c[f],i=a[g];if(b&&Object.isFunction(i)&&i.argumentNames().first()=="$super"){var j=i,i=function(a){return function(){return b[a].apply(this,arguments)}}(g).wrap(j);i.valueOf=j.valueOf.bind(j);i.toString=j.toString.bind(j)}this.prototype[g]=i;this.__type__==Class.Abstract&&(this[g]=i)}},addStatic:function(a){for(var b=
Object.keys(a),c=0,f=b.length;c<f;c++){var h=b[c];this[h]=a[h]}},addAttributes:function(a){Object.extendAttributes(this.prototype,a);this.__type__==Class.Abstract&&Object.extendAttributes(this,a)}}}();return{create:function(){var a=$A(arguments),c=Object.isFunction(a.first())?a.shift():null,d=function(){switch(this.__type__){case b.Abstract:throw Error("You cannot instantiate an abstract class.");default:if(Object.isFunction(this.initialize))return this.initialize.apply(this,arguments)}return null};
d["__miniLOL.Class__"]=!0;Object.extend(d,Class.Methods);d.superclass=c;d.subclasses=[];if(c){if(!c.__type__)c.__type__=b.Normal;if(!c.subclasses)c.subclasses=[];var f=Function.empty.clone();f.prototype=c.prototype;d.prototype=new f;c.subclasses.push(d)}d.__type__=d.prototype.__type__=a.first().type||Class.Normal;a.each(function(a){d.addMethods({initialize:a.initialize||a.constructor||Function.empty.clone()});d.addMethods(Object.without(a,["constructor","initialize","Methods","Static","Attributes"]));
d.addMethods(a.Methods||{});d.addStatic(a.Static||{});d.addAttributes(a.Attributes||{})});return d.prototype.constructor=d},Type:b,Methods:c}}();
miniLOL.utils=function(){return{exists:function(b){var c=!1;new Ajax.Request(b,{method:"head",asynchronous:!1,evalJS:!1,onSuccess:function(){c=!0}});return c},get:function(b,c){var c=Object.extend({raw:!0},c||{}),a;new Ajax.Request(b,Object.extend(c||{},{method:"get",asynchronous:!1,evalJS:!1,onSuccess:function(b){if(c.raw)a=b.responseText;else try{a=JSON.unserialize(b.responseText)}catch(d){a=b.responseXML||b.responseText}}}));return a},execute:function(b,c){var a,e;new Ajax.Request(b,Object.extend(c||
{},{method:"get",asynchronous:!1,evalJS:!1,onSuccess:function(c){try{a=window.eval(c.responseText)}catch(f){e=f,e.fileName=b,e.lineNumber-=5}},onFailure:function(a){e=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:b,status:a.status,statusText:a.statusText}));e.fileName=b;e.lineNumber=0}}));if(e)throw e;return a},include:function(b,c){c=c||{};if(b.startsWith("http"))return $(document.head).insert(new Element("script",{type:"text/javascript",src:b,id:c.id})),!0;
var a=!1;new Ajax.Request(b,Object.extend(c||{},{method:"get",asynchronous:!1,evalJS:!1,onSuccess:function(b){try{window.eval(b.responseText),a=!0}catch(c){a=!1}}}));return a},require:function(b,c){c=c||{};if(b.startsWith("http"))return $(document.head).insert(new Element("script",{type:"text/javascript",src:b,id:c.id})),!0;var a=!1;new Ajax.Request(b,Object.extend(c||{},{method:"get",asynchronous:!1,evalJS:!1,onSuccess:function(c){try{window.eval(c.responseText)}catch(d){a=d,a.fileName=b,a.lineNumber-=
5}},onFailure:function(c){a=Error("Failed to retrieve `#{file}` (#{status} - #{statusText}).".interpolate({file:b,status:c.status,statusText:c.statusText}));a.fileName=b;a.lineNumber=0;a.http={status:c.status,text:c.statusText}}}));if(a)throw a;return!0}}}();
miniLOL.File=Class.create({initialize:function(b,c){this.options=Object.extend({method:"get",asynchronous:!1,evalJS:!1,minified:!1,cached:!0,onSuccess:function(a){this.content=a.responseText;this.special=a.responseXML;this.loaded=!0;if(Object.isFunction(this.options.onLoaded))this.options.onLoaded(this)}.bind(this),onFailure:function(a){this.error=Object.clone(a)}.bind(this)},c||{});this.loaded=!1;this.path=b;this.extension=miniLOL.File.extension(b);new Ajax.Request(this.path,this.options)},reload:function(){this.loaded=
!1;new Ajax.Request(this.path,this.options)},interpolate:function(b,c){return c?this.content.interpolate(b,c):(new miniLOL.Template(this)).evaluate(b)},Static:{extension:function(b){return(b=b.match(/\.([^.]+)$/))?b[1]:""}}});
miniLOL.Template=Class.create({initialize:function(b,c){if(Object.is(miniLOL.File,b)){if(!b.loaded||!b.extension)throw"The File has to be loaded and have an extension.";this.engine=miniLOL.Template.Engine.get(b.extension);if(!this.engine)throw"Engine not available for the given file.";this.template=new this.engine(b.content)}else{this.engine=miniLOL.Template.Engine.get(c)||Template;if(!this.engine)throw"Engine not available for the given file.";this.template=new this.engine(b)}},evaluate:function(b,
c){return this.template.evaluate(b,c)}});miniLOL.Template.Engine=function(){var b={},c={};return{get:function(a){return b[(a||"").toLowerCase()]},add:function(a,c){b[a.toLowerCase()]||(b[a.toLowerCase()]=c)},load:function(a,b){c[a]||(miniLOL.utils.execute(a,b),c[a]=!0)}}}();
miniLOL.Document=function(){return{fix:Prototype.Browser.IE?function(b){if(b)return b={real:b},b.documentElement=b.real.documentElement,b.getElementsByTagName=function(b){return this.real.getElementsByTagName(b)},b.getElementById=function(b){return Element.xpath(this,"//*[@id='#{0}']".interpolate([b])).first()}.bind(b.real),b.real.setProperty("SelectionLanguage","XPath"),b.xpath=Element.xpath.bind(b.real),b.select=Element.select.bind(b.real),b}:Prototype.Browser.Good?function(b){if(b)return b.xpath=
Element.xpath,b.select=Element.select,b}:function(b){if(b)return b.getElementById=function(b){return this.xpath("//*[@id='#{0}']".interpolate([b])).first()},b.xpath=Element.xpath,b.select=Element.select,b},check:function(b,c){var a=!1;b||(a="There is a syntax error.");if(b.documentElement.nodeName=="parsererror")a=b.documentElement.textContent;c&&a&&miniLOL.error("Error while parsing #{path}\n\n#{error}".interpolate({path:c,error:a}),!0);return a}}}();
miniLOL.CSS=function(){return{include:function(b,c){c&&(c=b.replace(/\.css$/,".min.css"));var a=$$("link").find(function(a){return a.getAttribute("href")==b||a.getAttribute("href")===c});if(!a){if(c&&miniLOL.utils.exists(c))b=c;else if(!miniLOL.utils.exists(b))return!1;a=new Element("link",{rel:"stylesheet",href:b,type:"text/css"});$$("head")[0].insert(a);Event.fire(document,":css.included",a)}return a},create:function(b,c){var a=new Element("style",{type:"text/css"});Prototype.Browser.IE?a.styleSheet.cssText=
b:a.update(b);c&&a.setAttribute("id",c);$$("head").first().appendChild(a);Event.fire(document,":css.created",a);return a}}}();
miniLOL.Resource=Class.create({initialize:function(b,c){if(!c)throw Error("No wrapper has been passed.");this.name=b;this.wrapper=c;if(!this.wrapper.clear)this.wrapper.clear=function(){this.data={}};for(var a in this.wrapper){if(Object.isFunction(this.wrapper[a])){if(this.wrapper[a].parent==this.wrapper)break;this.wrapper[a]=this.wrapper[a].bind(this.wrapper);this.wrapper[a].parent=this.wrapper}Object.isUndefined(this[a])&&(this[a]=this.wrapper[a])}this.clear();this.flush();this.wrapper.initialize&&
this.wrapper.initialize()},load:function(){var b,c=$A(arguments);Event.fire(document,":resource.load",{resource:this,arguments:c});this.calls.push(c);try{b=this.wrapper.load.apply(this.wrapper,c)}catch(a){return miniLOL.error("Error while loading `#{name}` resource.\n#{error}".interpolate({name:this.name,error:a.toString()})),!1}Event.fire(document,":resource.loaded",{resource:this,arguments:c});return b},reload:function(){Event.fire(document,":resource.reload",{resource:this});this.wrapper.clear();
this.flush().each(function(b){this.load.apply(this,b)},this);Event.fire(document,":resource.reloaded",{resource:this})},clear:function(){Event.fire(document,":resource.clear",{resource:this});this.wrapper.clear()},flush:function(b){Event.fire(document,":resource.flush",{resource:this,call:b});var c;if(Object.isArray(b)){if(c=this.calls.find(function(a){if(a.length!=b.length)return!1;for(var c=!1,d=0;d<a.length;d++)if(b[d]==a[d]&&(c=!0),!c)break;return c}))this.calls=this.calls.filter(function(a){return a!=
c})}else c=this.calls,this.calls=[];return c},data:function(){return this.wrapper.data}});
miniLOL.JSON=function(){function b(a){return Object.isObject(a)?a.__miniLOL_is_xml?a.value.toXML():a.__miniLOL_is_function?Function.parse(a.value):miniLOL.JSON.unserializeSpecial(a):Object.isXML(a)?{__miniLOL_is_xml:!0,value:String.fromXML(a)}:Object.isFunction(a)?{__miniLOL_is_function:!0,value:a.toString()}:miniLOL.JSON.serializeSpecial(a)}function c(a){var c;if(Object.isObject(a)){c=Object.clone(a);for(var d in a)c[d]=b(a[d])}else Object.isArray(a)?(c=[],a.each(function(a){c.push(b(a))})):c=a;
return c}return{special:c,serializeSpecial:c,unserializeSpecial:c,serialize:function(a){try{return Object.toJSON(miniLOL.JSON.serializeSpecial(a))}catch(b){return!1}},unserialize:function(a){if(!Object.isString(a))return null;try{return miniLOL.JSON.unserializeSpecial(a.evalJSON())}catch(b){return null}},convert:b}}();
miniLOL.Cookie=function(){function b(a){return Object.extend({expires:new Date(Date.now()+(1).day().ms()),path:"",domain:"",secure:"",raw:!1},a||{})}function c(a,b,c){Object.isUndefined(c)&&(c={});return"#{key}=#{value}; #{maxAge}#{expires}#{path}#{domain}#{secure}".interpolate({key:a.encodeURIComponent(),value:b.encodeURIComponent(),maxAge:!Object.isUndefined(c.maxAge)?"max-age=#{0}; ".interpolate([c.maxAge]):"",expires:!Object.isUndefined(c.expires)?"expires=#{0}; ".interpolate([c.expires.toUTCString()]):
"",path:!Object.isUndefined(c.path)?"path=#{0}; ".interpolate([c.path]):"",domain:!Object.isUndefined(c.domain)?"domain=#{0}; ".interpolate([c.domain]):"",secure:c.secure?"secure":""})}function a(){var a=[];window.document.cookie.split(/; /).each(function(b){b=b.split(/=/);a.push(b[0])});return a.uniq()}function e(a,c){var c=b(c),d=window.document.cookie.match(RegExp.escape(a.encodeURIComponent())+"=([^;]*)","g");if(d){var e=[];$A(d).each(function(a){a=a.match(/^.*?=(.*)$/)[1].decodeURIComponent();
e.push(c.raw?a:miniLOL.JSON.unserialize(a)||a)});e.length==1&&(e=e[0]);return e}}function d(a,e){window.document.cookie=c(a,"",Object.extend(b(e),{expires:new Date(0)}))}return Object.extend(Enumerable,{_each:function(b){a().each(function(a){var c=e(a),d=[a,c];d.name=a;d.key=a;d.value=c;b(d)})},encode:c,keys:a,get:e,set:function(a,d,e){e=b(e);e.raw||(d=miniLOL.JSON.serialize(d)||d);window.document.cookie=c(a,d,e)},remove:d,unset:d,clear:function(){a().each(function(a){d(a)})}})}();
miniLOL.Storage=Class.create({initialize:function(b,c){this.name=b;this.backend=miniLOL.Storage.Instances[b]?miniLOL.Storage.Instances[b]:miniLOL.Storage.Instances[b]=new (c||miniLOL.Storage.Backends.available())(b)},get:function(b){return this.backend.get(b.toString())},set:function(b,c,a){return this.backend.set(b.toString(),c,a)},remove:function(b,c){return this.backend.remove(b.toString(),c)},clear:function(b){return this.backend.clear(b)},size:function(){return this.backend.size},save:function(){this.backend.save()}});
miniLOL.Storage.Instances={};
miniLOL.Storage.Backend=Class.create(Hash,{initialize:function($super,c,a){$super((Object.isString(a)?miniLOL.JSON.unserialize(a):a)||{});this.name=miniLOL.Storage.Backend.filter(c);if(Object.isString(a))this.size=a.size},get:function($super,c){return $super(c)},set:function($super,c,a,e){c=$super(c,a);e||this.save();return c},remove:function($super,c,a){c=$super(c);a||this.save();return c},clear:function($super,c){var a=$super();c||this.save();return a},replace:function($super,c){this.size=Object.isString(c)?
c.length:0;return $super(c)},Static:{filter:function(b){return b.replace(/\s/g,"")}}});
miniLOL.Storage.Backends={available:function(){try{return window.localStorage?miniLOL.Storage.Backends.LocalStorage:window.globalStorage?miniLOL.Storage.Backends.GlobalStorage:document.body.addBehavior?miniLOL.Storage.Backends.UserDataBehavior:miniLOL.Storage.Backends.Cookie}catch(b){return miniLOL.Storage.Backends.Null}},LocalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,c){$super(c);this.replace(window.localStorage["__miniLOL.storage."+this.name]||"{}")},save:function(){var b=
this.toJSON(!0);this.size=b.length;window.localStorage["__miniLOL.storage."+this.name]=b}}),GlobalStorage:Class.create(miniLOL.Storage.Backend,{initialize:function($super,c){$super(c);this.replace(window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]||"{}")},save:function(){var b=this.toJSON(!0);this.size=b.length;window.globalStorage[window.location.hostname]["__miniLOL.storage."+this.name]=b}}),UserDataBehavior:Class.create(miniLOL.Storage.Backend,{initialize:function($super,
c){$super(c);this.element=document.createElement("link");this.element.addBehavior("#default#userData");$$("head")[0].appendChild(this.element);this.element.load("__miniLOL.storage."+c);var a=this.element.getAttribute("__miniLOL.storage."+this.name)||"{}";this.size=a.length;this.replace(a)},save:function(){var b=this.toJSON(!0);this.size=b.length;this.element.setAttribute("__miniLOL.storage."+this.name,b);this.element.save("__miniLOL.storage."+this.name)}}),Cookie:Class.create(miniLOL.Storage.Backend,
{initialize:function($super,c){$super(c);this.replace(miniLOL.Cookie.get("__miniLOL.storage."+this.name,{raw:!0})||"{}")},save:function(){var b=this.toJSON(!0);this.size=b.length;miniLOL.Cookie.set("__miniLOL.storage."+this.name,b,{expires:31536E3,raw:!0})}}),Null:Class.create(miniLOL.Storage.Backend,{save:Function.empty})};
miniLOL.History={interval:0.15,initialize:function(){miniLOL.History.current=window.location.hash||"#";if(Prototype.Browser.Opera&&history.navigationMode)history.navigationMode="compatible";Event.observe(document,":url.change",function(b){miniLOL.History.current=b.memo.toString()||"#"});miniLOL.History.Initializers.get().call()},reset:function(b,c){if(Object.isNumber(b))miniLOL.History.interval=b;Object.isUndefined(miniLOL.History.timer)||clearInterval(miniLOL.History.timer);miniLOL.History.timer=
setInterval(c,miniLOL.History.interval*1E3)},Initializers:{get:function(){return"onhashchange"in window&&!(Prototype.Browser.InternetExplorer&&Prototype.Browser.Version==7)?miniLOL.History.Initializers.Default:Prototype.Browser.InternetExplorer?miniLOL.History.Initializers.InternetExplorer:miniLOL.History.Initializers.Unsupported},Default:function(){Event.observe(window,"hashchange",function(){Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||
"#"))})},Unsupported:function(){document.observe("dom:loaded",function(){miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.Default)})},InternetExplorer:function(){document.observe("dom:loaded",function(){miniLOL.History.IE={check:function(){(!miniLOL.History.IE.element.parentNode||miniLOL.History.IE.element.parentNode.nodeName=="#document-fragment")&&$(document.body).insert({top:miniLOL.History.IE.element})},put:function(b){miniLOL.History.IE.check();var c=miniLOL.History.IE.element.contentWindow.document;
c.open();c.close();c.location.hash=encodeURIComponent(b.substring(1))},get:function(){miniLOL.History.IE.check();return miniLOL.History.IE.element.contentWindow.document.location.hash},element:new Element("iframe",{id:"__miniLOL.History",style:"display: none !important; z-index: -9001 !important;",src:"javascript:false;"})};$(document.body).insert({top:miniLOL.History.IE.element});miniLOL.History.IE.put(miniLOL.History.current);miniLOL.History.reset(miniLOL.History.interval,miniLOL.History.Checkers.InternetExplorer)})}},
Checkers:{Default:function(){miniLOL.History.current!=window.location.hash&&Event.fire(document,":url.change",Prototype.Browser.Mozilla?window.location.hash||"#":decodeURIComponent(window.location.hash||"#"))},InternetExplorer:function(){var b={iframe:miniLOL.History.IE.get(),actual:window.location.hash||"#",current:miniLOL.History.current};if(b.actual!=b.iframe)b.actual&&b.actual==b.current?window.location.hash=(miniLOL.History.current=b.iframe).substring(1):miniLOL.History.IE.put(miniLOL.History.current=
b.actual),Event.fire(document,":url.change",miniLOL.History.current)}}};miniLOL.History.initialize();
